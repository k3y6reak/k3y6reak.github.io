<!DOCTYPE html>
<html lang="en">

  



<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
<link rel="stylesheet" href="/assets/css/cs_style.css">
<link rel="stylesheet" href="/assets/css/post.css">
<link rel="stylesheet" href="/assets/css/syntax.css">
<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>


  <body>

    <div class="container">
  <nav class="navbar navbar-default navbar-toggleable-md navbar-light bg-white">
  <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#containerNavbar" aria-controls="containerNavbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <a class="navbar-brand" href="/">K3Y6REAK</a>

  <div class="collapse navbar-collapse flex-row-reverse" id="containerNavbar">
    <ul class="navbar-nav my-2 my-md-0">
      <li class="nav-item active">
        <a class="nav-link" href="/about.html">About</a>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="http://example.com" id="dropdown04" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Programming</a>
        <div class="dropdown-menu" aria-labelledby="dropdown04">
          <a class="dropdown-item" href="/programming/c">C</a>
          <a class="dropdown-item" href="/programming/cpp">C++</a>
          <a class="dropdown-item" href="/programming/python">Python</a>
          <a class="dropdown-item" href="/programming/ruby">Ruby</a>
        </div>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="http://example.com" id="dropdown04" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">High Level Technique</a>
        <div class="dropdown-menu" aria-labelledby="dropdown04">
          <a class="dropdown-item" href="/technique/reversing">Reversing</a>
          <a class="dropdown-item" href="/technique/android">Android</a>
          <a class="dropdown-item" href="/technique/system_hacking">System Hacking</a>
          <a class="dropdown-item" href="/technique/powershell">PowerShell</a>
          <a class="dropdown-item" href="/technique/web_hacking">Web Hacking</a>
          <a class="dropdown-item" href="/technique/shellcoding">Shellcoding</a>
          <a class="dropdown-item" href="/technique/windows_system">Windows System</a>
          <a class="dropdown-item" href="/technique/windows_forensic">Windows Forensic</a>
          <a class="dropdown-item" href="/technique/linux_forensic">Linux Forensic</a>
        </div>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="http://example.com" id="dropdown04" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Wargame</a>
        <div class="dropdown-menu" aria-labelledby="dropdown04">
          <a class="dropdown-item" href="/wargame/reversing_kr">reversing.kr</a>
          <a class="dropdown-item" href="/wargame/pwnable_kr">pwnable.kr</a>
          <a class="dropdown-item" href="/wargame/wargame_kr">wargame.kr</a>
        </div>
      </li>

      <li class="nav-item">
        <a class="nav-link" href="/ctfs">CTFs</a>
      </li>

      <li class="nav-item">
        <a class="nav-link" href="/misc">MISC</a>
      </li>

    </ul>
  </div>
</nav>
</div>

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Extract APK</h1>
    <p class="post-meta">
      <time datetime="2017-10-30T19:55:00+09:00" itemprop="datePublished">
        
        Oct 30, 2017
      </time>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><br /><br /></p>
<h3 id="apk-추출하기">APK 추출하기</h3>

<p>APK를 분석하기 위해서는 APK 파일의 구조와 어떤 방식으로 동작하는지에 대해서 알아야 합니다. 먼저 APK 내에는 어떤 파일들이 존재하는지 알아보도록 합시다.
<br /></p>

<h4 id="unzip">Unzip</h4>

<p>먼저 Chrome.apk를 받아 <code class="highlighter-rouge">Hex Editor</code>를 이용해 열어봅니다.</p>

<figure class="highlight"><pre><code class="language-hex" data-lang="hex">Offset(d)00 01 02 03 04 05 06 07 08 09 10 11 12 13 14 15
00000000 50 4B 03 04 0A 00 00 08 00 00 00 00 21 3A 64 68 PK..........!:dh</code></pre></figure>

<p>Hex 값을 살펴본 결과 <code class="highlighter-rouge">PK</code>로 시작하는 것을 알 수 있습니다. PK로 시작하면 압축해제를 통해서 APK 안의 내용을 추출할 수 있습니다.</p>

<p><code class="highlighter-rouge">unzip [apk 이름] -d [디렉토리 이름]</code>을 이용해 해제할 디렉토리에 chrome.apk를 해제합니다.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">root@ubuntu:/home/k3y6reak/Desktop# </span>unzip chrome.apk -d Unzip_chrome/
Archive:  chrome.apk
 extracting: Unzip_chrome/assets/chrome_100_percent.pak  
 extracting: Unzip_chrome/assets/icudtl.dat  
 extracting: Unzip_chrome/assets/natives_blob.bin  
 extracting: Unzip_chrome/assets/resources.pak  
 extracting: Unzip_chrome/assets/snapshot_blob_32.bin  
 extracting: Unzip_chrome/assets/webapk_dex_version.txt  
 extracting: Unzip_chrome/lib/armeabi-v7a/crazy.libchrome.so  
 extracting: Unzip_chrome/lib/armeabi-v7a/libchrome.1847.114.so  
 extracting: Unzip_chrome/lib/armeabi-v7a/libchrome.1916.122.so  
 extracting: Unzip_chrome/lib/armeabi-v7a/libchrome.1916.138.so  
<span class="o">(</span>중략...<span class="o">)</span>
  inflating: Unzip_chrome/res/xml/usb_device_preferences.xml  
  inflating: Unzip_chrome/res/xml/website_preferences.xml  
  inflating: Unzip_chrome/META-INF/CERT.SF  
  inflating: Unzip_chrome/META-INF/CERT.RSA  
  inflating: Unzip_chrome/META-INF/MANIFEST.MF  
<span class="gp">root@ubuntu:/home/k3y6reak/Desktop# </span></code></pre></figure>

<p>해당 디렉토리에 접근하여 어떤 파일이 존재하는지 살펴보면 아래와 같습니다.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">root@ubuntu:/home/k3y6reak/Desktop/Unzip_chrome# </span>ls -al
total 10368
drwxr-xr-x  6 root     root        4096 Oct 31 20:05 .
drwxr-xr-x  4 k3y6reak k3y6reak    4096 Oct 31 20:05 ..
-rw-r--r--  1 root     root       95976 Jan  1  2009 AndroidManifest.xml
drwxr-xr-x  2 root     root        4096 Oct 31 20:05 assets
-rw-r--r--  1 root     root     6282576 Jan  1  2009 classes.dex
drwxr-xr-x  3 root     root        4096 Oct 31 20:05 lib
drwxr-xr-x  2 root     root        4096 Oct 31 20:05 META-INF
drwxr-xr-x 70 root     root        4096 Oct 31 20:05 res
-rw-r--r--  1 root     root     4206860 Jan  1  2009 resources.arsc</code></pre></figure>

<h4 id="apktool">Apktool</h4>

<p>이번에는 <code class="highlighter-rouge">apktool</code>을 이용해서 추출해 보도록 하겠습니다. apktool은 자바가 필요하며 사전에 설치가 돼있어야 합니다.
<a href="https://k3y6reak.github.io/misc/2017/11/01/Java_install.html">자바 설치</a></p>

<p>먼저 apktool을 설치해 보겠습니다. <a href="https://ibotpeaches.github.io/Apktool/install">여기</a>에 접속하면 각 운영체제별 설치방법이 나와있습니다. Ubuntu를 기준으로 Linux 설치방법을 따르면 됩니다.</p>

<p>여기서 주의할 점은 Ubuntu 내에서 apt-get 을 이용해 미리 설치하신 분은 낮은 버전으로 실행되기 때문에 <code class="highlighter-rouge">apt-get purge apktool</code>을 한 뒤 설치를 해주면 됩니다.</p>

<p>wrapper script 파일을 apktool로 저장합니다. apktool_2.3.0.jar을 apktool.jar로 저장합니다.
이 두 파일을 <code class="highlighter-rouge">/usr/bin</code>에 저장한 뒤 <code class="highlighter-rouge">chmod +x apktool apktool.jar</code>을 해줍니다.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">root@ubuntu:/home/k3y6reak/Desktop# </span>mv wrapperscript.txt apktool
<span class="gp">root@ubuntu:/home/k3y6reak/Desktop# </span>mv apktool_2.3.0.jar apktool.jar
<span class="gp">root@ubuntu:/home/k3y6reak/Desktop# </span>chmod +x apktool apktool.jar
<span class="gp">root@ubuntu:/home/k3y6reak/Desktop# </span>mv apktool apktool.jar /usr/bin
<span class="gp">root@ubuntu:/home/k3y6reak/Desktop# </span>apktool
Apktool v2.3.0 - a tool <span class="k">for </span>reengineering Android apk files
with smali v2.2.1 and baksmali v2.2.1
Copyright 2014 Ryszard Wiśniewski &lt;brut.alll@gmail.com&gt;
Updated by Connor Tumbleson &lt;connor.tumbleson@gmail.com&gt;

usage: apktool
 -advance,--advanced   prints advance information.
 -version,--version    prints the version <span class="k">then </span>exits
usage: apktool <span class="k">if</span>|install-framework <span class="o">[</span>options] &lt;framework.apk&gt;
 -p,--frame-path &lt;dir&gt;   Stores framework files into &lt;dir&gt;.
 -t,--tag &lt;tag&gt;          Tag frameworks using &lt;tag&gt;.
usage: apktool d[ecode] <span class="o">[</span>options] &lt;file_apk&gt;
 -f,--force              Force delete destination directory.
 -o,--output &lt;dir&gt;       The name of folder that gets written. Default is apk.out
 -p,--frame-path &lt;dir&gt;   Uses framework files located <span class="k">in</span> &lt;dir&gt;.
 -r,--no-res             Do not decode resources.
 -s,--no-src             Do not decode sources.
 -t,--frame-tag &lt;tag&gt;    Uses framework files tagged by &lt;tag&gt;.
usage: apktool b[uild] <span class="o">[</span>options] &lt;app_path&gt;
 -f,--force-all          Skip changes detection and build all files.
 -o,--output &lt;dir&gt;       The name of apk that gets written. Default is dist/name.apk
 -p,--frame-path &lt;dir&gt;   Uses framework files located <span class="k">in</span> &lt;dir&gt;.

For additional info, see: http://ibotpeaches.github.io/Apktool/ 
For smali/baksmali info, see: https://github.com/JesusFreke/smali</code></pre></figure>

<p>이제 apktool을 사용할 수 있으므로 이를 이용해 chrome.apk를 Decompile을 해보겠습니다.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">root@ubuntu:/home/k3y6reak/Desktop# </span>apktool d chrome.apk
I: Using Apktool 2.3.0 on chrome.apk
I: Loading resource table...
I: Decoding AndroidManifest.xml with resources...
S: WARNING: Could not write to <span class="o">(</span>/root/.local/share/apktool/framework<span class="o">)</span>, using /tmp instead...
S: Please be aware this is a volatile directory and frameworks could go missing, please utilize --frame-path <span class="k">if </span>the default storage directory is unavailable
I: Loading resource table from file: /tmp/1.apk
I: Regular manifest package...
I: Decoding file-resources...
I: Decoding values <span class="k">*</span>/<span class="k">*</span> XMLs...
I: Baksmaling classes.dex...
I: Copying assets and libs...
I: Copying unknown files...
I: Copying original files...
<span class="gp">root@ubuntu:/home/k3y6reak/Desktop# </span><span class="nb">cd </span>chrome
<span class="gp">root@ubuntu:/home/k3y6reak/Desktop/chrome# </span>ls
AndroidManifest.xml  apktool.yml  assets  lib  original  res  smali</code></pre></figure>

<p><code class="highlighter-rouge">apktool 버전이 낮은 경우 main함수에서 null point exception이 발생할 수 있습니다.</code></p>

<h4 id="jadx">jadx</h4>

<p>또 다른 방법으로는 jadx를 이용하는 방법이 있습니다. 마찬가지로 Java가 필요하기 때문에 자바를 설치해야 합니다. 여기서 주의할 점은 8버전을 설치하면 jadx가 실행되지 않을 수 있습니다. <code class="highlighter-rouge">7버전으로 설치해야 합니다.</code></p>

<p><code class="highlighter-rouge">git clone https://github.com/skylot/jadx.git</code>을 통해 해당 파일을 다운로드 받습니다.
다운받은 jadx 디렉토리에 접근하여 <code class="highlighter-rouge">./gradlew dist</code>를 입력하여 컴파일을 합니다.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">root@ubuntu:~# </span>git clone https://github.com/skylot/jadx.git
Cloning into <span class="s1">'jadx'</span>...
remote: Counting objects: 11711, <span class="k">done</span>.
remote: Total 11711 <span class="o">(</span>delta 0<span class="o">)</span>, reused 0 <span class="o">(</span>delta 0<span class="o">)</span>, pack-reused 11710
Receiving objects: 100% <span class="o">(</span>11711/11711<span class="o">)</span>, 5.31 MiB | 1.43 MiB/s, <span class="k">done</span>.
Resolving deltas: 100% <span class="o">(</span>6143/6143<span class="o">)</span>, <span class="k">done</span>.
Checking connectivity... <span class="k">done</span>.
<span class="gp">root@ubuntu:~# </span><span class="nb">cd </span>jadx
<span class="gp">root@ubuntu:~/jadx# </span>./gradlew dist
:jadx-core:compileJava
warning: <span class="o">[</span>options] bootstrap class path not <span class="nb">set </span><span class="k">in </span>conjunction with -source 1.6
/root/jadx/jadx-core/src/main/java/jadx/core/xmlgen/ParserConstants.java:156: warning: <span class="o">[</span>serial] serializable class &lt;anonymous jadx.core.xmlgen.ParserConstants<span class="nv">$1</span>&gt; has no definition of serialVersionUID
        protected static final Map&lt;Integer, String&gt; PLURALS_MAP <span class="o">=</span> new HashMap&lt;Integer, String&gt;<span class="o">()</span> <span class="o">{</span>
                                                                                                 ^
/root/jadx/jadx-core/src/main/java/jadx/core/dex/instructions/args/LiteralArg.java:68: warning: <span class="o">[</span>deprecation] literalToString<span class="o">(</span>long,ArgType<span class="o">)</span> <span class="k">in </span>TypeGen has been deprecated
                        String value <span class="o">=</span> TypeGen.literalToString<span class="o">(</span>literal, getType<span class="o">())</span>;
                                              ^
3 warnings
:jadx-core:compileGroovy UP-TO-DATE
:jadx-core:processResources
:jadx-core:classes
:jadx-core:jar
:jadx-cli:compileJava
warning: <span class="o">[</span>options] bootstrap class path not <span class="nb">set </span><span class="k">in </span>conjunction with -source 1.6
<span class="o">(</span>중략...<span class="o">)</span>
:jadx-gui:installDist
:copyArtifacts
:pack
:dist

BUILD SUCCESSFUL

Total <span class="nb">time</span>: 7.471 secs

This build could be faster, please consider using the Gradle Daemon: https://docs.gradle.org/2.14.1/userguide/gradle_daemon.html
root@ubuntu:~/jadx#</code></pre></figure>

<p>컴파일을 모두 마치면 <code class="highlighter-rouge">build</code>라는 디렉토리가 생성되는데 <code class="highlighter-rouge">build/jadx/bin/</code>에 jadx 실행파일이 생성된 것을 볼 수 있습니다.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">root@ubuntu:~/jadx# </span>ls
build  build.gradle  gradle  gradlew  gradlew.bat  jadx-cli  jadx-core  jadx-gui  jadx-samples  jadx-test-app  LICENSE  NOTICE  README.md  settings.gradle  version
<span class="gp">root@ubuntu:~/jadx# </span><span class="nb">cd </span>build/
<span class="gp">root@ubuntu:~/jadx/build# </span>ls
jadx  jadx-0.6.1.zip
<span class="gp">root@ubuntu:~/jadx/build# </span><span class="nb">cd </span>jadx
<span class="gp">root@ubuntu:~/jadx/build/jadx# </span>ls
bin  lib  LICENSE  NOTICE  README.md
<span class="gp">root@ubuntu:~/jadx/build/jadx# </span><span class="nb">cd </span>bin
<span class="gp">root@ubuntu:~/jadx/build/jadx/bin# </span>ls
jadx  jadx.bat  jadx-gui  jadx-gui.bat</code></pre></figure>

<p><code class="highlighter-rouge">jadx [애플리케이션.apk]</code> 또는 <code class="highlighter-rouge">jadx-gui</code>로 실행 후 apk 파일을 넣어주면 됩니다.</p>

<p>이 외에 몇가지 부분은 나중에 추가하도록 하겠습니다.</p>

  </div>

  
</article>

      </div>
    </main>

    



<div class="container">
	<hr>
	<section class="float-left">
		&copy; 2017. SAHONG PAK all rights reserved.
	</section>
	<section class="float-right">
		<a href="http://blog.rebforpwn.com">
			<img src="/assets/img/rebforpwn.png" alt="RebForPwn" height="32" width="100">
		</a>

		<a href="http://">
		<img src="/assets/img/github.svg" alt="github" height="32" width="32">
		</a>

		<a href="mailto:k3y6reak@naver.com">
		<img src="/assets/img/mail.svg" alt="mail" height="32" width="32">
		</a>
	</section>
</div>

  </body>

</html>
