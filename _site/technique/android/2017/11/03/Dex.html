<!DOCTYPE html>
<html lang="en">

  



<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
<link rel="stylesheet" href="/assets/css/cs_style.css">
<link rel="stylesheet" href="/assets/css/post.css">
<link rel="stylesheet" href="/assets/css/syntax.css">
<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>


  <body>

    <div class="container">
  <nav class="navbar navbar-default navbar-toggleable-md navbar-light bg-white">
  <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#containerNavbar" aria-controls="containerNavbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <a class="navbar-brand" href="/">K3Y6REAK</a>

  <div class="collapse navbar-collapse flex-row-reverse" id="containerNavbar">
    <ul class="navbar-nav my-2 my-md-0">
      <li class="nav-item active">
        <a class="nav-link" href="/about.html">About</a>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="http://example.com" id="dropdown04" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Programming</a>
        <div class="dropdown-menu" aria-labelledby="dropdown04">
          <a class="dropdown-item" href="/programming/c">C</a>
          <a class="dropdown-item" href="/programming/cpp">C++</a>
          <a class="dropdown-item" href="/programming/python">Python</a>
          <a class="dropdown-item" href="/programming/ruby">Ruby</a>
        </div>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="http://example.com" id="dropdown04" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">High Level Technique</a>
        <div class="dropdown-menu" aria-labelledby="dropdown04">
          <a class="dropdown-item" href="/technique/reversing">Reversing</a>
          <a class="dropdown-item" href="/technique/android">Android</a>
          <a class="dropdown-item" href="/technique/system_hacking">System Hacking</a>
          <a class="dropdown-item" href="/technique/powershell">PowerShell</a>
          <a class="dropdown-item" href="/technique/web_hacking">Web Hacking</a>
          <a class="dropdown-item" href="/technique/shellcoding">Shellcoding</a>
          <a class="dropdown-item" href="/technique/windows_system">Windows System</a>
          <a class="dropdown-item" href="/technique/windows_forensic">Windows Forensic</a>
          <a class="dropdown-item" href="/technique/linux_forensic">Linux Forensic</a>
        </div>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="http://example.com" id="dropdown04" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Wargame</a>
        <div class="dropdown-menu" aria-labelledby="dropdown04">
          <a class="dropdown-item" href="/wargame/reversing_kr">reversing.kr</a>
          <a class="dropdown-item" href="/wargame/pwnable_kr">pwnable.kr</a>
          <a class="dropdown-item" href="/wargame/wargame_kr">wargame.kr</a>
        </div>
      </li>

      <li class="nav-item">
        <a class="nav-link" href="/ctfs">CTFs</a>
      </li>

      <li class="nav-item">
        <a class="nav-link" href="/misc">MISC</a>
      </li>

    </ul>
  </div>
</nav>
</div>

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Dex</h1>
    <p class="post-meta">
      <time datetime="2017-11-03T17:12:00+09:00" itemprop="datePublished">
        
        Nov 3, 2017
      </time>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><br /><br /></p>
<h3 id="dex">Dex</h3>

<p>Dex는 Android에서 사용되는 파일로 Windows의 PE 파일과 같은 존재입니다. Dex는 Dalvik Executable을 줄여놓은 것으로 Dalvik Virtual Machine에서 동작합니다.</p>

<p>Dex의 Signature는 <code class="highlighter-rouge">64 65 78 0a 30 33 35 00(dex\n035)</code> 로 시작합니다.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">k3y6reak:SoundMeter k3y6reak<span class="nv">$ </span>ls
AndroidManifest.xml	classes.dex		resources.arsc
META-INF		res
k3y6reak:SoundMeter k3y6reak<span class="nv">$ </span>hexdump -C classes.dex | more
00000000  64 65 78 0a 30 33 35 00  e2 50 cf a8 1b 24 b9 ce  |dex.035..P...<span class="nv">$.</span>.|</code></pre></figure>

<p><code class="highlighter-rouge">unzip</code>으로 추출한 classes.dex 파일을 분석해야 하는데 이때 사용하는 툴이 dex2jar가 있습니다.</p>

<p><a href="https://sourceforge.net/projects/dex2jar/">dex2jar</a>에서 해당 파일을 다운로드 받습니다.</p>

<p>압축을 해제한 후 Ubuntu에서 사용하기 때문에 <code class="highlighter-rouge">d2j-dex2jar.sh</code>를 이용해 <code class="highlighter-rouge">jar</code> 파일을 추출합니다.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">root@ubuntu:~/dex2jar# </span>ls
d2j-baksmali.bat   d2j-dex-recompute-checksum.bat  d2j-jar2jasmin.bat  d2j-std-apk.bat
d2j-baksmali.sh    d2j-dex-recompute-checksum.sh   d2j-jar2jasmin.sh   d2j-std-apk.sh
d2j-dex2jar.bat    d2j_invoke.bat                  d2j-jasmin2jar.bat  lib
d2j-dex2jar.sh     d2j_invoke.sh                   d2j-jasmin2jar.sh   SoundMeter.apk
d2j-dex2smali.bat  d2j-jar2dex.bat                 d2j-smali.bat
d2j-dex2smali.sh   d2j-jar2dex.sh                  d2j-smali.sh
<span class="gp">root@ubuntu:~/dex2jar# </span>./d2j-dex2jar.sh SoundMeter.apk
dex2jar SoundMeter.apk -&gt; ./SoundMeter-dex2jar.jar
<span class="gp">root@ubuntu:~/dex2jar# </span>ls
d2j-baksmali.bat   d2j-dex-recompute-checksum.bat  d2j-jar2jasmin.bat  d2j-std-apk.bat
d2j-baksmali.sh    d2j-dex-recompute-checksum.sh   d2j-jar2jasmin.sh   d2j-std-apk.sh
d2j-dex2jar.bat    d2j_invoke.bat                  d2j-jasmin2jar.bat  lib
d2j-dex2jar.sh     d2j_invoke.sh                   d2j-jasmin2jar.sh   SoundMeter.apk
d2j-dex2smali.bat  d2j-jar2dex.bat                 d2j-smali.bat       SoundMeter-dex2jar.jar
d2j-dex2smali.sh   d2j-jar2dex.sh                  d2j-smali.sh</code></pre></figure>

<p><code class="highlighter-rouge">SoundMeter-dex2jar.jar</code>파일이 추출된 것을 볼 수 있습니다. 이제 jar 파일을 다시 <code class="highlighter-rouge">Java Decompiler</code>를 이용해 자바코드로 변환합니다.</p>

<p><a href="http://jd.benow.ca/">JD-GUI</a>에서 운영체제에 맞는 파일을 받아 실행합니다.
jar 파일을 받은경우 <code class="highlighter-rouge">java -jar jd-gui-1.4.0.jar</code> 로 실행하면 됩니다.</p>

<p><img src="/img/android/dex/execute_jdgui.png" alt="jd_gui" /></p>

<p>실행 후 해당 apk를 드래그 앤 드롭으로 넣어주면 자동으로 분석을 해줍니다.</p>

<p>또 다른 방법으로는 <code class="highlighter-rouge">010 Editor</code>를 사용하는 방법입니다. <a href="http://www.sweetscape.com/010editor/">010Editor</a>에서 다운로드 받을 수 있습니다. 010 Editor는 <code class="highlighter-rouge">Template</code>을 이용해 파일의 구조를 분석할 수 있습니다.</p>

<p><a href="https://github.com/strazzere/010Editor-stuff/tree/master/Templates">Templates_Github</a>에서 여러 종류의 템플릿을 받을 수 있으며 여기서 사용할 파일은 <code class="highlighter-rouge">DEXTemplate.bt</code>이므로 이 파일을 받아주면 됩니다.</p>

<p><code class="highlighter-rouge">classes.dex</code>파일을 010 Editor에 올리고 다운로드 받은 Dex template을 실행하면 됩니다.
상단의 메뉴에서 Templates - Open Template - DexTemplate.bt - Run Template를 선택합니다.</p>

<p>Github에서 받은 파일이 에러 간다면 <a href="https://www.sweetscape.com/010editor/templates/">Templates_sweetscape</a>에서 받아서 실행해보세요.</p>

<p><img src="/img/android/dex/editor.png" alt="editor" /></p>


  </div>

  
</article>

      </div>
    </main>

    



<div class="container">
	<hr>
	<section class="float-left">
		&copy; 2017. SAHONG PAK all rights reserved.
	</section>
	<section class="float-right">
		<a href="http://blog.rebforpwn.com">
			<img src="/assets/img/rebforpwn.png" alt="RebForPwn" height="32" width="100">
		</a>

		<a href="http://">
		<img src="/assets/img/github.svg" alt="github" height="32" width="32">
		</a>

		<a href="mailto:k3y6reak@naver.com">
		<img src="/assets/img/mail.svg" alt="mail" height="32" width="32">
		</a>
	</section>
</div>

  </body>

</html>
