<!DOCTYPE html>
<html lang="en">

  



<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/css/bootstrap.min.css" integrity="sha384-rwoIResjU2yc3z8GV/NPeZWAv56rSmLldC3R/AZzGRnGxQQKnKkoFVhFQhNUwEyJ" crossorigin="anonymous">
<link rel="stylesheet" href="/assets/css/cs_style.css">
<link rel="stylesheet" href="/assets/css/post.css">
<link rel="stylesheet" href="/assets/css/syntax.css">
<script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tether/1.4.0/js/tether.min.js" integrity="sha384-DztdAPBWPRXSA/3eYEEUWrWCy7G5KFbe8fFjk5JAIxUYHKkDx6Qin1DkWx51bBrb" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.6/js/bootstrap.min.js" integrity="sha384-vBWWzlZJ8ea9aCX4pEW3rVHjgjt7zpkNpZk+02D9phzyeVkE+jo0ieGizqPLForn" crossorigin="anonymous"></script>


  <body>

    <div class="container">
  <nav class="navbar navbar-default navbar-toggleable-md navbar-light bg-white">
  <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#containerNavbar" aria-controls="containerNavbar" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <a class="navbar-brand" href="/">K3Y6REAK</a>

  <div class="collapse navbar-collapse flex-row-reverse" id="containerNavbar">
    <ul class="navbar-nav my-2 my-md-0">
      <li class="nav-item active">
        <a class="nav-link" href="/about.html">About</a>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="http://example.com" id="dropdown04" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Programming</a>
        <div class="dropdown-menu" aria-labelledby="dropdown04">
          <a class="dropdown-item" href="/programming/c">C</a>
          <a class="dropdown-item" href="/programming/cpp">C++</a>
          <a class="dropdown-item" href="/programming/python">Python</a>
          <a class="dropdown-item" href="/programming/ruby">Ruby</a>
        </div>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="http://example.com" id="dropdown04" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">High Level Technique</a>
        <div class="dropdown-menu" aria-labelledby="dropdown04">
          <a class="dropdown-item" href="/technique/reversing">Reversing</a>
          <a class="dropdown-item" href="/technique/android">Android</a>
          <a class="dropdown-item" href="/technique/system_hacking">System Hacking</a>
          <a class="dropdown-item" href="/technique/powershell">PowerShell</a>
          <a class="dropdown-item" href="/technique/web_hacking">Web Hacking</a>
          <a class="dropdown-item" href="/technique/shellcoding">Shellcoding</a>
          <a class="dropdown-item" href="/technique/windows_system">Windows System</a>
          <a class="dropdown-item" href="/technique/windows_forensic">Windows Forensic</a>
          <a class="dropdown-item" href="/technique/linux_forensic">Linux Forensic</a>
        </div>
      </li>

      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" href="http://example.com" id="dropdown04" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Wargame</a>
        <div class="dropdown-menu" aria-labelledby="dropdown04">
          <a class="dropdown-item" href="/wargame/reversing_kr">reversing.kr</a>
          <a class="dropdown-item" href="/wargame/pwnable_kr">pwnable.kr</a>
          <a class="dropdown-item" href="/wargame/wargame_kr">wargame.kr</a>
        </div>
      </li>

      <li class="nav-item">
        <a class="nav-link" href="/ctfs">CTFs</a>
      </li>

      <li class="nav-item">
        <a class="nav-link" href="/misc">MISC</a>
      </li>

    </ul>
  </div>
</nav>
</div>

    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">COM</h1>
    <p class="post-meta">
      <time datetime="2017-09-06T19:14:00+09:00" itemprop="datePublished">
        
        Sep 6, 2017
      </time>
      </p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><br /><br /></p>

<p><code class="highlighter-rouge">COM</code>은 Component Object Model로 <a href="https://ko.wikipedia.org/wiki/%EC%BB%B4%ED%8F%AC%EB%84%8C%ED%8A%B8_%EC%98%A4%EB%B8%8C%EC%A0%9D%ED%8A%B8_%EB%AA%A8%EB%8D%B8">위키백과</a>를 참조하길 바란다.</p>

<p>PowerShell에서 <code class="highlighter-rouge">ComObject</code>를 이용해 Registry에 접근할 수 있다.</p>

<p><code class="highlighter-rouge">Get-ChildItem REGISTRY::HKEY_CLASSES_ROOT\CLSID -include PROGID -recurse | ForEach {$_.GetValue("")}</code>를 실행해 보자.</p>

<figure class="highlight"><pre><code class="language-ps" data-lang="ps">PS C:\WINDOWS\system32&gt; Get-ChildItem REGISTRY::HKEY_CLASSES_ROOT\CLSID -include PROGID -recurse | ForEach {$_.GetValue("")}
file
StaticMetafile
StaticDib
clsid
objref
ADODB.Command.6.0
ADODB.Parameter.6.0
ADODB.Connection.6.0
ADODB.Recordset.6.0
...(생략)</code></pre></figure>

<p>많은 결과가 출력되는데 이 중 <code class="highlighter-rouge">wscript</code>만 출력해 보자. <code class="highlighter-rouge">| Where-Object {$_ -match "wscript"}</code>를 붙여주면 된다. wscript는 윈도우에서 사용하는 스크립트다.</p>

<figure class="highlight"><pre><code class="language-ps" data-lang="ps">PS C:\WINDOWS\system32&gt; Get-ChildItem REGISTRY::HKEY_CLASSES_ROOT\CLSID -include PROGID -recurse | ForEach {$_.GetValue("")} | Where-Object {$_ -match "wscript"}
WScript.Network.1
WScript.Shell.1
WScript.Shell.1
WScript.Network.1</code></pre></figure>

<p>여기서 WScript.Shell.1을 사용해보자.</p>

<p><code class="highlighter-rouge">$wscript = New-Object -ComObject Wscript.Shell.1</code>을 입력한 후 <code class="highlighter-rouge">$wscript | Get-Member</code>을 입력해 보자.</p>

<figure class="highlight"><pre><code class="language-ps" data-lang="ps">PS C:\WINDOWS\system32&gt; $wscript = New-Object -ComObject Wscript.Shell.1
PS C:\WINDOWS\system32&gt; $wscript | Get-Member


   TypeName: System.__ComObject#{41904400-be18-11d3-a28b-00104bd35090}

Name                     MemberType            Definition
----                     ----------            ----------
AppActivate              Method                bool AppActivate (Variant, Variant)
CreateShortcut           Method                IDispatch CreateShortcut (string)
Exec                     Method                IWshExec Exec (string)
ExpandEnvironmentStrings Method                string ExpandEnvironmentStrings (string)
LogEvent                 Method                bool LogEvent (Variant, string, string)
Popup                    Method                int Popup (string, Variant, Variant, Variant)
RegDelete                Method                void RegDelete (string)
RegRead                  Method                Variant RegRead (string)
RegWrite                 Method                void RegWrite (string, Variant, Variant)
Run                      Method                int Run (string, Variant, Variant)
SendKeys                 Method                void SendKeys (string, Variant)
Environment              ParameterizedProperty IWshEnvironment Environment (Variant) {get}
CurrentDirectory         Property              string CurrentDirectory () {get} {set}
SpecialFolders           Property              IWshCollection SpecialFolders () {get}</code></pre></figure>

<p>사용할 수 있는 Method들이 출력된 것을 볼 수 있다.</p>

<figure class="highlight"><pre><code class="language-ps" data-lang="ps">PS C:\WINDOWS\system32&gt; $wscript.CurrentDirectory
C:\WINDOWS\system32
PS C:\WINDOWS\system32&gt; $wscript.Exec("notepad.exe")


Status    : 0
StdIn     : System.__ComObject
StdOut    : System.__ComObject
StdErr    : System.__ComObject
ProcessID : 8056
ExitCode  : 0</code></pre></figure>

<p>이렇게 사용할 수 있다.</p>


  </div>

  
</article>

      </div>
    </main>

    



<div class="container">
	<hr>
	<section class="float-left">
		&copy; 2017. SAHONG PAK all rights reserved.
	</section>
	<section class="float-right">
		<a href="http://blog.rebforpwn.com">
			<img src="/assets/img/rebforpwn.png" alt="RebForPwn" height="32" width="100">
		</a>

		<a href="http://">
		<img src="/assets/img/github.svg" alt="github" height="32" width="32">
		</a>

		<a href="mailto:k3y6reak@naver.com">
		<img src="/assets/img/mail.svg" alt="mail" height="32" width="32">
		</a>
	</section>
</div>

  </body>

</html>
